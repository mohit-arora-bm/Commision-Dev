<aura:component controller="TemplateDataLoaderController">
	<!-- Exposed Attributes start -->
    <aura:attribute name="objectAPIName" type="String"/>
    <aura:attribute name="selectedRowId" type="String"/>
	<aura:attribute name="fieldsList" type="Object[]"/>
	<aura:attribute name="deleteRecordId" type="String"/>
	<aura:attribute name="title" type="String"/>
	<aura:attribute name="showDeleteModal" type="Boolean" default="false"/>
    <!-- Exposed Attributes end -->
    
	<!-- Private Attributes start -->
	<aura:attribute name="columns" type="Object[]"/>
	<aura:attribute name="allData" type="Object[]"/>
	<aura:attribute name="searchedData" type="Object[]"/>
	<aura:attribute name="endIndex" type="Integer" default="20" />
    <!-- Private Attributes end -->

	<aura:handler name="init" value="{! this }" action="{! c.doInit }"/>
	<aura:registerEvent name="recordSelectEvent" type="c:AQ_GenericEvent"/>
    
	
	<c:AQ_DataService aura:id="dataService" />

	<lightning:card title="{! v.title }" >
       <lightning:spinner alternativeText="Loading" size="small" variant="brand" aura:id="spinner"/>
        <aura:set attribute="actions">
			<div class="slds-form-element">
				<div class="slds-form-element__control">
					<lightning:button name='new' label='New' onclick="{! c.createNewTemplate }"/>
				</div>
			</div>
        </aura:set>
        <p class="slds-p-horizontal_small">
			<div class="slds-form-element">
				<div class="slds-form-element__control">
					<div class="slds-input-has-icon slds-input-has-icon_right" >
						<input type="text" class="slds-input" autoComplete="off"  placeholder="Search Templates..." onkeyup="{! c.searchProducts }" />
						<span class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_right">
							<lightning:icon iconName="utility:search" size="xx-small" />
						</span>
					</div>
				</div>
			</div>
			<br></br>
			<div class="slds-scrollable_y tableDiv" onscroll="{!c.handleScroll}" aura:id="scrollDiv">
				<table class="slds-table slds-table_cell-buffer slds-table_bordered " >
					<thead>
						<tr class=' slds-line-height_reset'>
							<th scope="col" >
								<div class="slds-truncate" >Name</div>
							</th>
						</tr>
					</thead>
					<tbody>
						<aura:iteration items="{! v.searchedData }" var="recordVar" end="{!v.endIndex}">
							<tr class="{! if(v.selectedRowId eq recordVar.recordId, 'selected', '') + ' slds-hint-parent'}"
								id="{! recordVar.recordId }">
								<aura:iteration items="{! recordVar.fieldsList }" var="fieldVar">
									<td data-label="{! fieldVar.fieldLabel }" id="{! recordVar.recordId }" >
										<div class="slds-truncate" id="{! recordVar.recordId }">
											<lightning:icon size="x-small" class="pointer" iconName="utility:delete" alternativeText="{! recordVar.recordId }" onclick="{! c.deleteRow }"/>
											&nbsp;
											<a id="{! recordVar.recordId }"  onclick="{! c.handleRowSelect }">{! fieldVar.fieldValue }</a>
										</div>
									</td>
								</aura:iteration>
							</tr>	
						</aura:iteration>
					</tbody>
				</table>
			</div>
        </p>
	</lightning:card>
	<!-- warning modal -->
	<aura:if isTrue="{! v.showDeleteModal }">
		<section role="dialog" aria-modal="true" class="slds-modal slds-fade-in-open">
			<div class="slds-modal__container">
				<header class="slds-modal__header">
					<h2 class="slds-text-heading_medium slds-hyphenate">Warning!</h2>
				</header>
				<div class="slds-modal__content slds-p-around_medium">
					<center>
						<p>
							This action is irreversible.<br/>Are you sure you want to delete this Container Product?
						</p>
					</center>
				</div>
				<footer class="slds-modal__footer">
					<lightning:button label="No" title="No" onclick="{! c.cancelDelete }"/>
					<lightning:button label="Yes" title="Yes" variant="brand" onclick="{! c.deleteTemplate }"/>
				</footer>
			</div>
		</section>
		<div class="slds-backdrop slds-backdrop_open"></div>
	</aura:if>
</aura:component>